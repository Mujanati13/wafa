<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Compatibility Test - WAFA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ccc;
            background: #f9f9f9;
        }
        .pass {
            border-left-color: #4caf50;
            background: #f1f8f1;
        }
        .fail {
            border-left-color: #f44336;
            background: #fff1f1;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1976D2;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass {
            background: #4caf50;
            color: white;
        }
        .status.fail {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üîç Browser Compatibility Test for WAFA</h1>
    <p><strong>Current Browser:</strong> <span id="browser-info"></span></p>
    
    <div class="test-section">
        <h2>üç™ Cookie & Storage Tests</h2>
        <div id="cookie-tests"></div>
        <button onclick="testCookies()">Test Cookies</button>
    </div>

    <div class="test-section">
        <h2>üåê CORS & API Connection Test</h2>
        <div id="cors-tests"></div>
        <label>
            API URL: 
            <input type="text" id="api-url" value="http://localhost:5010/api/v1/test" style="width: 400px; padding: 8px;">
        </label>
        <br>
        <button onclick="testCORS()">Test API Connection</button>
    </div>

    <div class="test-section">
        <h2>üîê Session Test</h2>
        <div id="session-tests"></div>
        <button onclick="testSession()">Test Session Persistence</button>
    </div>

    <div class="test-section">
        <h2>üìã Browser Features</h2>
        <div id="feature-tests"></div>
        <button onclick="testFeatures()">Test Browser Features</button>
    </div>

    <div class="test-section">
        <h2>üìä Results Summary</h2>
        <div id="summary"></div>
    </div>

    <script>
        // Detect browser
        function detectBrowser() {
            const ua = navigator.userAgent;
            let browserName = "Unknown";
            
            if (ua.indexOf("Firefox") > -1) {
                browserName = "Firefox";
            } else if (ua.indexOf("Brave") > -1 || (navigator.brave && typeof navigator.brave.isBrave === 'function')) {
                browserName = "Brave";
            } else if (ua.indexOf("Edg") > -1) {
                browserName = "Edge";
            } else if (ua.indexOf("Chrome") > -1) {
                browserName = "Chrome";
            } else if (ua.indexOf("Safari") > -1) {
                browserName = "Safari";
            }
            
            document.getElementById('browser-info').textContent = browserName;
            return browserName;
        }

        detectBrowser();

        // Test Cookies
        function testCookies() {
            const results = [];
            const output = document.getElementById('cookie-tests');
            
            // Test 1: Can create cookies
            try {
                document.cookie = "test_cookie=1; path=/; SameSite=Lax";
                const canCreate = document.cookie.indexOf('test_cookie=1') > -1;
                results.push({
                    name: 'Create Cookie',
                    pass: canCreate,
                    detail: canCreate ? 'Can create cookies' : 'Cannot create cookies'
                });
            } catch (e) {
                results.push({
                    name: 'Create Cookie',
                    pass: false,
                    detail: 'Error: ' + e.message
                });
            }

            // Test 2: localStorage
            try {
                localStorage.setItem('test', '1');
                const canUseLocalStorage = localStorage.getItem('test') === '1';
                localStorage.removeItem('test');
                results.push({
                    name: 'localStorage',
                    pass: canUseLocalStorage,
                    detail: canUseLocalStorage ? 'localStorage works' : 'localStorage not available'
                });
            } catch (e) {
                results.push({
                    name: 'localStorage',
                    pass: false,
                    detail: 'Error: ' + e.message
                });
            }

            // Test 3: sessionStorage
            try {
                sessionStorage.setItem('test', '1');
                const canUseSessionStorage = sessionStorage.getItem('test') === '1';
                sessionStorage.removeItem('test');
                results.push({
                    name: 'sessionStorage',
                    pass: canUseSessionStorage,
                    detail: canUseSessionStorage ? 'sessionStorage works' : 'sessionStorage not available'
                });
            } catch (e) {
                results.push({
                    name: 'sessionStorage',
                    pass: false,
                    detail: 'Error: ' + e.message
                });
            }

            displayResults(output, results);
        }

        // Test CORS
        async function testCORS() {
            const results = [];
            const output = document.getElementById('cors-tests');
            const apiUrl = document.getElementById('api-url').value;
            
            output.innerHTML = '<p>Testing connection to: ' + apiUrl + '</p>';
            
            // Test 1: Basic fetch
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                results.push({
                    name: 'API Connection',
                    pass: response.ok,
                    detail: `Status: ${response.status}, Data: ${JSON.stringify(data)}`
                });

                // Check CORS headers
                const corsHeader = response.headers.get('Access-Control-Allow-Credentials');
                results.push({
                    name: 'CORS Credentials',
                    pass: corsHeader === 'true',
                    detail: `Access-Control-Allow-Credentials: ${corsHeader || 'not set'}`
                });

            } catch (e) {
                results.push({
                    name: 'API Connection',
                    pass: false,
                    detail: 'Error: ' + e.message + ' (Check if backend is running)'
                });
            }

            displayResults(output, results);
        }

        // Test Session
        function testSession() {
            const results = [];
            const output = document.getElementById('session-tests');
            
            // Check if sessionStorage persists
            const testKey = 'session_test_' + Date.now();
            sessionStorage.setItem(testKey, 'test_value');
            
            setTimeout(() => {
                const value = sessionStorage.getItem(testKey);
                results.push({
                    name: 'Session Persistence',
                    pass: value === 'test_value',
                    detail: value ? 'Session data persists' : 'Session data lost'
                });
                sessionStorage.removeItem(testKey);
                displayResults(output, results);
            }, 100);
        }

        // Test Browser Features
        function testFeatures() {
            const results = [];
            const output = document.getElementById('feature-tests');
            
            // Test various features
            const features = [
                { name: 'Fetch API', test: () => typeof fetch !== 'undefined' },
                { name: 'Promise', test: () => typeof Promise !== 'undefined' },
                { name: 'async/await', test: () => { try { eval('(async () => {})'); return true; } catch(e) { return false; } } },
                { name: 'ES6 Classes', test: () => { try { eval('class Test {}'); return true; } catch(e) { return false; } } },
                { name: 'Arrow Functions', test: () => { try { eval('() => {}'); return true; } catch(e) { return false; } } },
                { name: 'Spread Operator', test: () => { try { eval('[...[]');return true; } catch(e) { return false; } } },
                { name: 'const/let', test: () => { try { eval('const x = 1; let y = 2;'); return true; } catch(e) { return false; } } },
                { name: 'Template Literals', test: () => { try { eval('`test`'); return true; } catch(e) { return false; } } }
            ];

            features.forEach(feature => {
                try {
                    const pass = feature.test();
                    results.push({
                        name: feature.name,
                        pass: pass,
                        detail: pass ? 'Supported' : 'Not supported'
                    });
                } catch (e) {
                    results.push({
                        name: feature.name,
                        pass: false,
                        detail: 'Error: ' + e.message
                    });
                }
            });

            displayResults(output, results);
        }

        // Display results helper
        function displayResults(container, results) {
            let html = '';
            results.forEach(result => {
                html += `
                    <div class="test-item ${result.pass ? 'pass' : 'fail'}">
                        <strong>${result.name}</strong>
                        <span class="status ${result.pass ? 'pass' : 'fail'}">${result.pass ? 'PASS' : 'FAIL'}</span>
                        <br>
                        <small>${result.detail}</small>
                    </div>
                `;
            });
            container.innerHTML = html;
            updateSummary();
        }

        // Update summary
        function updateSummary() {
            const allTests = document.querySelectorAll('.test-item');
            const passed = document.querySelectorAll('.test-item.pass').length;
            const failed = document.querySelectorAll('.test-item.fail').length;
            
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <h3>Total Tests: ${allTests.length}</h3>
                <p style="color: #4caf50; font-size: 24px;">‚úì Passed: ${passed}</p>
                <p style="color: #f44336; font-size: 24px;">‚úó Failed: ${failed}</p>
            `;
        }

        // Cookie debugging info
        console.log('=== Cookie Debugging ===');
        console.log('Current cookies:', document.cookie);
        console.log('localStorage available:', typeof localStorage !== 'undefined');
        console.log('sessionStorage available:', typeof sessionStorage !== 'undefined');
        console.log('Browser:', detectBrowser());
        console.log('User Agent:', navigator.userAgent);
    </script>
</body>
</html>
